<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Anime-Sama - Page Corrig√©e</title>
    <link rel="stylesheet" href="src/styles/anime-sama.css">
    <style>
        /* Styles de base pour la d√©mo */
        body {
            margin: 0;
            padding: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
        }
        
        .demo-header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }
        
        .demo-header h1 {
            color: #2563eb;
            margin: 0;
            font-size: 2rem;
            font-weight: 700;
        }
        
        .demo-header p {
            color: #64748b;
            margin: 0.5rem 0 0 0;
            font-size: 1rem;
        }
        
        .demo-container {
            max-width: 1200px;
            margin: 2rem auto;
            padding: 2rem;
            background: white;
            border-radius: 12px;
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }
        
        .bug-fixes-summary {
            background: #f0f9ff;
            border-left: 4px solid #2563eb;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border-radius: 0 8px 8px 0;
        }
        
        .bug-fixes-summary h2 {
            color: #1e40af;
            margin: 0 0 1rem 0;
            font-size: 1.5rem;
        }
        
        .bug-fixes-list {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        
        .bug-fixes-list li {
            padding: 0.5rem 0;
            color: #374151;
            position: relative;
            padding-left: 2rem;
        }
        
        .bug-fixes-list li::before {
            content: "‚úì";
            position: absolute;
            left: 0;
            color: #10b981;
            font-weight: bold;
            font-size: 1.2rem;
        }
        
        .api-demo {
            background: #fefce8;
            border: 1px solid #fbbf24;
            border-radius: 8px;
            padding: 1.5rem;
            margin-bottom: 2rem;
        }
        
        .api-demo h3 {
            color: #92400e;
            margin: 0 0 1rem 0;
        }
        
        .api-endpoint {
            font-family: 'Monaco', 'Consolas', monospace;
            background: #1f2937;
            color: #e5e7eb;
            padding: 1rem;
            border-radius: 6px;
            margin: 1rem 0;
            overflow-x: auto;
        }
        
        .test-button {
            background: #2563eb;
            color: white;
            padding: 0.75rem 1.5rem;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-weight: 500;
            transition: background-color 0.2s ease;
            margin: 0.5rem 0.5rem 0.5rem 0;
        }
        
        .test-button:hover {
            background: #1d4ed8;
        }
        
        .test-results {
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 6px;
            padding: 1rem;
            margin-top: 1rem;
            max-height: 400px;
            overflow-y: auto;
        }
        
        .test-results pre {
            margin: 0;
            white-space: pre-wrap;
            font-size: 0.875rem;
            color: #374151;
        }
        
        .loading {
            color: #f59e0b;
        }
        
        .success {
            color: #10b981;
        }
        
        .error {
            color: #ef4444;
        }
    </style>
</head>
<body>
    <div class="demo-header">
        <h1>Page Anime-Sama - Bugs Corrig√©s</h1>
        <p>D√©monstration des corrections apport√©es selon la documentation des erreurs</p>
    </div>

    <div class="demo-container">
        <div class="bug-fixes-summary">
            <h2>üîß Corrections Appliqu√©es</h2>
            <ul class="bug-fixes-list">
                <li><strong>Race conditions √©limin√©es</strong> - Plus de synchronisation entre selectedEpisode et loadEpisodeSources</li>
                <li><strong>Changement de langue optimis√©</strong> - Pr√©servation de l'√©pisode actuel lors du switch VF/VOSTFR</li>
                <li><strong>Cache local impl√©ment√©</strong> - R√©duction des appels API redondants avec TTL de 5 minutes</li>
                <li><strong>Retry automatique</strong> - Gestion robuste des timeouts et erreurs serveur</li>
                <li><strong>Interface responsive</strong> - Adaptation mobile et tablette compl√®te</li>
                <li><strong>Gestion d'erreurs am√©lior√©e</strong> - Messages utilisateur sp√©cifiques par type d'erreur</li>
                <li><strong>Annulation de requ√™tes</strong> - AbortController pour √©viter les appels API obsol√®tes</li>
                <li><strong>√âtats de chargement coh√©rents</strong> - Loading states pr√©cis pour chaque action</li>
            </ul>
        </div>

        <div class="api-demo">
            <h3>üîó Test de l'API Anime-Sama</h3>
            <p>API de production utilis√©e:</p>
            <div class="api-endpoint">https://api-anime-sama.onrender.com</div>
            
            <button class="test-button" onclick="testHealthEndpoint()">Test Health</button>
            <button class="test-button" onclick="testSearchEndpoint()">Test Search</button>
            <button class="test-button" onclick="testAnimeDetails()">Test One Piece</button>
            <button class="test-button" onclick="testSeasonEpisodes()">Test Saison</button>
            
            <div id="test-results" class="test-results" style="display: none;">
                <pre id="results-content"></pre>
            </div>
        </div>

        <div id="anime-demo">
            <h3>üì∫ Composant Anime-Sama</h3>
            <p>Le composant React corrig√© sera int√©gr√© ici une fois React configur√©.</p>
            <p>En attendant, vous pouvez tester les endpoints API ci-dessus pour v√©rifier la connectivit√©.</p>
            
            <div style="background: #f3f4f6; padding: 1.5rem; border-radius: 8px; margin-top: 1rem;">
                <h4>Fonctionnalit√©s principales du composant corrig√©:</h4>
                <ul style="margin: 1rem 0;">
                    <li>Synchronisation parfaite entre s√©lection d'√©pisode et chargement des sources</li>
                    <li>Changement de langue sans perte d'√©pisode actuel</li>
                    <li>Cache intelligent pour r√©duire les appels API</li>
                    <li>Interface enti√®rement responsive</li>
                    <li>Gestion d'erreurs robuste avec retry automatique</li>
                    <li>Navigation fluide entre √©pisodes</li>
                </ul>
            </div>
        </div>
    </div>

    <script>
        const API_BASE = 'https://api-anime-sama.onrender.com';
        
        function showResults(content, type = 'info') {
            const resultsDiv = document.getElementById('test-results');
            const resultsContent = document.getElementById('results-content');
            
            resultsDiv.style.display = 'block';
            resultsContent.className = type;
            resultsContent.textContent = content;
        }
        
        async function testHealthEndpoint() {
            showResults('‚è≥ Test de l\'endpoint health...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/api/health`);
                const data = await response.json();
                
                showResults(
                    `‚úÖ Health Check R√©ussi\n\n` +
                    `Status: ${data.status}\n` +
                    `Timestamp: ${data.timestamp}\n` +
                    `Environment: ${data.environment}\n` +
                    `Version: ${data.version}`,
                    'success'
                );
            } catch (error) {
                showResults(
                    `‚ùå Erreur Health Check\n\n` +
                    `Message: ${error.message}\n` +
                    `V√©rifiez que l'API est d√©ploy√©e et accessible.`,
                    'error'
                );
            }
        }
        
        async function testSearchEndpoint() {
            showResults('‚è≥ Test de recherche "One Piece"...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/api/search?q=one piece`);
                const data = await response.json();
                
                if (data.success && data.data.length > 0) {
                    const anime = data.data[0];
                    showResults(
                        `‚úÖ Recherche R√©ussie\n\n` +
                        `Anime trouv√©: ${anime.title}\n` +
                        `ID: ${anime.id}\n` +
                        `Description: ${anime.description.substring(0, 100)}...\n` +
                        `Genres: ${anime.genres.join(', ')}\n` +
                        `Ann√©e: ${anime.year}`,
                        'success'
                    );
                } else {
                    showResults('‚ùå Aucun r√©sultat trouv√© pour "One Piece"', 'error');
                }
            } catch (error) {
                showResults(
                    `‚ùå Erreur Recherche\n\n` +
                    `Message: ${error.message}`,
                    'error'
                );
            }
        }
        
        async function testAnimeDetails() {
            showResults('‚è≥ Test d√©tails One Piece...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/api/anime/one-piece`);
                const data = await response.json();
                
                if (data.success && data.data) {
                    const anime = data.data;
                    showResults(
                        `‚úÖ D√©tails Anime R√©cup√©r√©s\n\n` +
                        `Titre: ${anime.title}\n` +
                        `Status: ${anime.status}\n` +
                        `Nombre de saisons: ${anime.seasons.length}\n` +
                        `Genres: ${anime.genres.join(', ')}\n` +
                        `Progression: ${anime.progressInfo?.advancement || 'N/A'}\n` +
                        `Total √©pisodes: ${anime.progressInfo?.totalEpisodes || 'N/A'}`,
                        'success'
                    );
                } else {
                    showResults('‚ùå Impossible de r√©cup√©rer les d√©tails de One Piece', 'error');
                }
            } catch (error) {
                showResults(
                    `‚ùå Erreur D√©tails Anime\n\n` +
                    `Message: ${error.message}`,
                    'error'
                );
            }
        }
        
        async function testSeasonEpisodes() {
            showResults('‚è≥ Test √©pisodes saison One Piece...', 'loading');
            
            try {
                const response = await fetch(`${API_BASE}/api/seasons?animeId=one-piece&season=21&language=vostfr`);
                const data = await response.json();
                
                if (data.success && data.data?.episodes) {
                    const episodes = data.data.episodes;
                    showResults(
                        `‚úÖ √âpisodes de Saison R√©cup√©r√©s\n\n` +
                        `Saison: ${data.data.seasonInfo.name}\n` +
                        `Nombre d'√©pisodes: ${episodes.length}\n` +
                        `Premier √©pisode: ${episodes[0].episodeNumber} - ${episodes[0].title}\n` +
                        `Dernier √©pisode: ${episodes[episodes.length-1].episodeNumber} - ${episodes[episodes.length-1].title}\n` +
                        `Langue: ${episodes[0].language}`,
                        'success'
                    );
                } else {
                    showResults('‚ùå Impossible de r√©cup√©rer les √©pisodes de la saison', 'error');
                }
            } catch (error) {
                showResults(
                    `‚ùå Erreur √âpisodes Saison\n\n` +
                    `Message: ${error.message}`,
                    'error'
                );
            }
        }
    </script>
</body>
</html>